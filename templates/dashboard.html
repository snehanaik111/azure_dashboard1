<!DOCTYPE html>
<html lang="en">
<head>
  <title>Dashboard</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/static/css/dashboard.css">
  <link rel="stylesheet" href="/static/css/responsive.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
 
</head>
<body>
  <!-- for header part -->
  <header> 
      <div class="logosec" style="float: left ;"> 
          <div class="logo">Fuel Management System</div> 
      </div> 
      <div class="searchbar"> 
          <input type="text" placeholder="Search"> 
          <div class="searchbtn"> 
            <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210180758/Untitled-design-(28).png" class="icn srchicn" alt="search-icon"> 
          </div> 
      </div> 
      <div class="message"> 
        Welcome! <b>Name:</b> {{user.name}} <b>Email:</b> {{user.email}}    
      </div> 
  </header> 

  <div class="main-container"> 
      <div class="navcontainer"> 
          <nav class="nav"> 
              <div class="nav-upper-options"> 
                  <div class="nav-option option1"> 
                      <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210182148/Untitled-design-(29).png" class="nav-img" alt="dashboard"> 
                      <h5> Dashboard</h5> 
                  </div> 
                  <div class="option2 nav-option"> 
                      <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210183322/9.png" class="nav-img" alt="articles"> 
                      <h4> Vehicles</h4> 
                  </div> 
                  <div class="nav-option option3"> 
                      <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210183320/5.png" class="nav-img" alt="report"> 
                      <h4>Fuel Report</h4> 
                  </div> 
                  <div class="nav-option option4"> 
                      <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210183321/6.png" class="nav-img" alt="institution"> 
                      <h4> Institution</h4> 
                  </div> 
                  <div class="nav-option option5"> 
                      <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210183323/10.png" class="nav-img" alt="blog"> 
                      <h4> Profile</h4> 
                  </div> 
                  <div class="nav-option option6"> 
                      <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210183320/4.png" class="nav-img" alt="settings"> 
                      <h4> Settings</h4> 
                  </div> 
                  <div class="nav-option logout"> 
                    <a href="/logout" class="button2">Logout</a>
                  </div> 
              </div> 
          </nav> 
      </div> 
      <div class="main"> 
          <div class="searchbar2"> 
              <input type="text" placeholder="Search"> 
              <div class="searchbtn"> 
                <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210180758/Untitled-design-(28).png" class="icn srchicn" alt="search-button"> 
              </div> 
          </div> 
          <div class="box-container"> 
            <div class="box box1"> 
                <div class="text"> 
                    <h2 id="devices-connected" class="topic-heading">{{ sensor_data_count }}</h2> 
                    <h2 class="topic">Device Entries Logged</h2> 
                </div> 
                <img src="/static/imgs/sensor.png" alt="Views"> 
            </div> 
            <div class="box box2"> 
                <div class="text"> 
                    <h2 id="total-fuel-tracked" class="topic-heading">{{ imei_count }}</h2> 
                    <h2 class="topic">No of Devices active </h2> 
                </div> 
                <img src="/static/imgs/car.png" alt="likes"> 
            </div> 
              <div class="box box3"> 
                  <div class="text"> 
                      <h2 class="topic-heading">320</h2> 
                      <h2 class="topic">Comments</h2> 
                  </div> 
                  <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210184645/Untitled-design-(32).png" alt="comments"> 
              </div> 
              <div class="box box4"> 
                  <div class="text"> 
                      <h2 class="topic-heading">70</h2> 
                      <h2 class="topic">Published</h2> 
                  </div> 
                  <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210185029/13.png" alt="published"> 
              </div> 
          </div> 
          <div class="report-container"> 
              <div class="report-header"> 
                  <h2 class="recent-Articles">Recent Activity</h2> 
              </div> 
              <br>
              <div>
                <h2>Fuel Consumption Line Chart</h2>
                <canvas id="fuelChart" width="400" height="200"></canvas>
              </div>
              <script>
                var ctx = document.getElementById('fuelChart').getContext('2d');
                var fuelChart = new Chart(ctx, {
                  type: 'line',
                  data: {
                    labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
                    datasets: [{
                      label: 'Fuel Consumption',
                      data: [65, 59, 80, 81, 56, 55, 40],
                      borderColor: 'rgba(255, 99, 132, 1)',
                      borderWidth: 1
                    }]
                  },
                  options: {
                    scales: {
                      y: { beginAtZero: true }
                    }
                  }
                });
              </script> 
              <br>
              <h2>Sensor Data Receiver</h2>
              <div class="search-filter-container">


                  <!-- Filter button -->
                  <form method="GET" action="{{ url_for('dashboard') }}" class="filter-form">
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="filterDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Filter
                        </button>
                        <div class="dropdown-menu" aria-labelledby="filterDropdown">
                            <button class="dropdown-item" type="submit" name="filter" value="desc">Latest First</button>
                            <button class="dropdown-item" type="submit" name="filter" value="asc">Oldest First</button>
                        </div>
                    </div>
                </form>

                
<br>




                <!-- Search button and input -->

                <input type="text" id="searchInput" placeholder="Search...">
                <button onclick="search()" id="searchbtn">Search</button>
                
            
              
            </div>
<br>

              <div class="table-responsive">
                  <table class="table table-bordered">
                      <thead>
                          <tr>
                              <th>ID</th>
                              <th>Date</th>
                              <th>Address</th>
                              <th>Sensor Data</th>
                              <th>IMEI</th>
                          </tr>
                      </thead>
                      <tbody id="sensorDataBody">
                          {% for entry in sense_data %}
                          <tr>
                              <td>{{ entry.id }}</td>
                              <td>{{ entry.date }}</td>
                              <td>{{ entry.full_addr }}</td>
                              <td>{{ entry.sensor_data }}</td>
                              <td>{{ entry.imei }}</td>
                          </tr>
                          {% endfor %}
                      </tbody>

                      


                  </table>
                  <div class="pagination-container">
                    <div class="pagination">
                        {% if page > 1 %}
                        <a href="{{ url_for('dashboard', page=page-1) }}"><button>Previous</button></a>
                        {% endif %}
                        
                        Page {{ page }}  of  {{ total_pages }}
                        
                        {% if page < total_pages %}
                        <a href="{{ url_for('dashboard', page=page+1) }}"><button>Next</button></a>
                        {% endif %}
                    </div>
                </div>
                   
              </div>


             <!-- <button id="showFormBtn" class="btn btn-primary mb-3">Add New Entry</button>
              <form action="/add_crud" method="POST">
                  <div class="form-group">
                      <label for="vehicle">Vehicle:</label>
                      <input type="text" class="form-control" id="vehicle" name="vehicle" required>
                  </div>
                  <div class="form-group">
                      <label for="type">Type:</label>
                      <input type="text" class="form-control" id="type" name="type" required>
                  </div>
                  <div class="form-group">
                      <label for="fuel_consumption">Fuel Consumption:</label>
                      <input type="text" class="form-control" id="fuel_consumption" name="fuel_consumption" required>
                  </div>
                  <button type="submit" class="btn btn-primary">Submit</button>
              </form>-->

         <!--     <script>
                  document.getElementById("showFormBtn").addEventListener("click", function() {
                      var form = document.querySelector("form");
                      if (form.style.display === "none") {
                          form.style.display = "block";
                      } else {
                          form.style.display = "none";
                      }
                  });
              </script>-->
              <script>
                  $(document).ready(function() {
                      function updateCounts() {
                          $.ajax({
                              url: '/api/sensor_data_count',
                              method: 'GET',
                              success: function(data) {
                                  $('#devices-connected').text(data.count);
                              },
                              error: function(error) {
                                  console.error('Error fetching sensor data count:', error);
                              }
                          });

                          $.ajax({
                              url: '/api/imei_count',
                              method: 'GET',
                              success: function(data) {
                                  $('#total-fuel-tracked').text(data.count);
                              },
                              error: function(error) {
                                  console.error('Error fetching IMEI count:', error);
                              }
                          });
                      }

                      updateCounts();
                      setInterval(updateCounts, 60000); // Update counts every minute
                  });
              </script>

<!--Page count function-->

<!--Search for table -->

<script>
  function search() {
      var searchText = document.getElementById("searchInput").value;
      $.ajax({
          url: '/search_sensor_data',
          type: 'GET',
          data: {query: searchText},
          success: function(response) {
              var tbody = document.getElementById("sensorDataBody");
              tbody.innerHTML = ""; // Clear existing rows
              response.forEach(function(entry) {
                  var row = "<tr><td>" + entry.id + "</td><td>" + entry.date + "</td><td>" + entry.full_addr + "</td><td>" + entry.sensor_data + "</td><td>" + entry.imei + "</td></tr>";
                  tbody.innerHTML += row;
              });
          },
          error: function(xhr, status, error) {
              console.error('Error searching data:', error);
          }
      });
  }
</script>


          </div> 
      </div> 
  </div> 
</body>
</html>
